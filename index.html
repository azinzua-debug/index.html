<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="favicom_cosnet.png" rel="icon" type="image/x-icon">
  <link rel="stylesheet" href="styles.css">
  <title>CosNet</title>
</head>
<body>
  <h1>üé≠ Perfiles Art√≠sticos</h1>

  <div id="filtros">
    <select id="categoriaRol">
      <option value="">Todos los roles</option>
      <option value="aprendiz">Aprendiz</option>
      <option value="mentor">Mentor</option>
      <option value="ambos">Ambos</option>
    </select>
  </div>

  <div id="perfiles"></div>

  <script>
    const API_URL = "/api/proxy.js"; // ‚úÖ Se conecta al proxy local

    async function cargarPerfiles() {
      const contenedor = document.getElementById("perfiles");
      const rolFiltro = document.getElementById("categoriaRol").value;

      try {
        const res = await fetch(API_URL);
        const perfiles = await res.json();

        if (!Array.isArray(perfiles) || perfiles.length === 0) {
          contenedor.innerHTML = "<p>No hay perfiles disponibles.</p>";
          return;
        }

        const filtrados = rolFiltro
          ? perfiles.filter(p => p.rol?.toLowerCase() === rolFiltro)
          : perfiles;

        contenedor.innerHTML = filtrados.map((p, i) => `
          <div class="perfil" style="border-color:${generarColorGradiente(i, perfiles.length)};">
            <h2>${p.nombre || "Sin nombre"}</h2>
            <p><b>Rol:</b> ${p.rol || "N/A"}</p>
            <p><b>Descripci√≥n:</b> ${p.descripcion || "Sin descripci√≥n"}</p>
            <button onclick="verPerfil('${p.id}')">Ver perfil</button>
          </div>
        `).join("");

      } catch (err) {
        console.error("‚ùå Error al cargar perfiles:", err);
        contenedor.innerHTML = "<p style='color:red;'>Error al cargar perfiles.</p>";
      }
    }

    function generarColorGradiente(index, total) {
      const start = [255, 0, 0]; // rojo
      const end = [128, 0, 255]; // morado
      const ratio = index / (total - 1);
      const r = Math.round(start[0] + ratio * (end[0] - start[0]));
      const g = Math.round(start[1] + ratio * (end[1] - start[1]));
      const b = Math.round(start[2] + ratio * (end[2] - start[2]));
      return `rgb(${r},${g},${b})`;
    }

    function verPerfil(id) {
      window.location.href = `perfil.html?id=${id}`;
    }

    document.getElementById("categoriaRol").addEventListener("change", cargarPerfiles);
    cargarPerfiles();
  </script>
</body>
</html>
