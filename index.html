<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="favicom_cosnet.png" rel="icon" type="image/x-icon">
  <title>CosNet UY</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <h1>üé≠ Descubre Cosplayers de Uruguay</h1>

  <div id="filtros">
    <select id="filtroEspecialidad">
      <option value="todas">Todas las Especialidades</option>
      <option value="armaduras">Armaduras</option>
      <option value="props">Props</option>
      <option value="pelucas">Pelucas</option>
      <option value="costura">Costura</option>
      <option value="maquillaje">Maquillaje</option>
    </select>

    <select id="filtroRol">
      <option value="todos">Todos los Roles</option>
      <option value="Aprendiz">Aprendiz</option>
      <option value="Mentor">Mentor</option>
      <option value="Ambos">Ambos</option>
    </select>
  </div>

  <div id="perfiles"></div>

  <script>
    const API_URL = "https://cosneto-proxy.onrender.com"; // Cambia a tu API
    const contenedor = document.getElementById("perfiles");
    const filtroEspecialidad = document.getElementById("filtroEspecialidad");
    const filtroRol = document.getElementById("filtroRol");

    let perfiles = [];

    // --- Funci√≥n de color intermedio entre dos hex ---
    function colorIntermedio(hex1, hex2, factor) {
      const c1 = parseInt(hex1.slice(1), 16);
      const c2 = parseInt(hex2.slice(1), 16);
      const r1 = (c1 >> 16) & 0xff, g1 = (c1 >> 8) & 0xff, b1 = c1 & 0xff;
      const r2 = (c2 >> 16) & 0xff, g2 = (c2 >> 8) & 0xff, b2 = c2 & 0xff;
      const r = Math.round(r1 + factor * (r2 - r1));
      const g = Math.round(g1 + factor * (g2 - g1));
      const b = Math.round(b1 + factor * (b2 - b1));
      return `rgb(${r}, ${g}, ${b})`;
    }

    async function cargarPerfiles() {
      try {
        const res = await fetch(API_URL);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        perfiles = await res.json();
        renderizarPerfiles();
      } catch (err) {
        console.error("‚ùå Error al cargar perfiles:", err);
        contenedor.innerHTML = "<p style='color:red;'>Error al cargar perfiles.</p>";
      }
    }

    function renderizarPerfiles() {
      const especialidad = filtroEspecialidad.value.toLowerCase();
      const rol = filtroRol.value.toLowerCase();

      let filtrados = perfiles.filter(p => {
        const coincideRol = rol === "todos" || (p.rol && p.rol.toLowerCase() === rol);
        const coincideEsp = especialidad === "todas" ||
          (Array.isArray(p.especialidades) &&
           p.especialidades.some(e => e.toLowerCase().includes(especialidad)));
        return coincideRol && coincideEsp;
      });

      if (filtrados.length === 0) {
        contenedor.innerHTML = "<p>No hay perfiles disponibles.</p>";
        return;
      }

      const colorInicio = "#ff0044"; // rojo
      const colorFin = "#8f00ff"; // violeta

      contenedor.innerHTML = filtrados.map((p, i) => {
        const factor = filtrados.length === 1 ? 0 : i / (filtrados.length - 1);
        const color = colorIntermedio(colorInicio, colorFin, factor);
        return `
          <div class="perfil" style="border-color:${color}; box-shadow:0 0 10px ${color};">
            <h2>${p.nombre || "Sin nombre"}</h2>
            <p><b>Rol:</b> ${p.rol || "N/A"}</p>
            <p><b>Descripci√≥n:</b> ${p.descripcion || "Sin descripci√≥n"}</p>
            <p><b>Especialidades:</b> ${Array.isArray(p.especialidades) ? p.especialidades.join(", ") : (p.especialidades || "N/A")}</p>
            <p><b>Redes:</b> ${p.redes || "No especificadas"}</p>
            <p><b>Proyectos:</b> ${p.proyectos || "No especificados"}</p>
            <p><b>Cosplays:</b> ${p.cosplays || "No especificados"}</p>
          </div>
        `;
      }).join("");
    }

    filtroEspecialidad.addEventListener("change", renderizarPerfiles);
    filtroRol.addEventListener("change", renderizarPerfiles);

    cargarPerfiles();
  </script>
</body>
</html>
