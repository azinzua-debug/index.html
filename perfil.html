const API_URL = "/api/proxy";
const id = new URLSearchParams(window.location.search).get("id");

async function cargarPerfil() {
  const contenedor = document.getElementById("perfil");

  try {
    const res = await fetch(API_URL);
    const { perfiles, portafolio } = await res.json();
    const perfil = perfiles.find(p => String(p.id) === String(id));

    if (!perfil) {
      contenedor.innerHTML = "<p>Perfil no encontrado.</p>";
      return;
    }

    contenedor.innerHTML = `
      <div class="perfil-header">
        <img src="${perfil.banner || 'https://i.imgur.com/HTF5eQe.png'}" alt="${perfil.nombre}">
        <div class="perfil-datos">
          <h2>${perfil.nombre}</h2>
          <p><b>Rol:</b> ${perfil.rol || "N/A"}</p>
          <p>${perfil.descripcion || "Sin descripciÃ³n"}</p>
          <p><b>Especialidades:</b> ${Array.isArray(perfil.especialidades) ? perfil.especialidades.join(', ') : perfil.especialidades}</p>
          <p><b>Redes:</b> ${perfil.redes || "No especificadas"}</p>
        </div>
      </div>
      <h3 style="color:#6c8cff;">ðŸ“¸ Portafolio</h3>
      <div id="galeria" class="galeria"><p>Cargando...</p></div>
      <a href="index.html" class="volver">â¬… Volver a la lista</a>
    `;

    // Mostrar las imÃ¡genes del portafolio
    const imgs = portafolio.filter(i => String(i.user_id) === String(id));
    const galeria = document.getElementById("galeria");
    galeria.innerHTML = imgs.length
      ? imgs.map(i => `<img src="${i.url}" alt="Cosplay">`).join("")
      : "<p>Sin imÃ¡genes disponibles.</p>";

  } catch (err) {
    console.error(err);
    contenedor.innerHTML = "<p style='color:red;'>Error al cargar el perfil.</p>";
  }
}

cargarPerfil();
